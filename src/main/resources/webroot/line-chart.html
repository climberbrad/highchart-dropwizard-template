<html>
<head>
    <title>Static HighChart</title>
    <link rel="stylesheet" href="css/form.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>

    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.0/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.12.0/jquery-ui.js"></script>
</head>
<div>
    <script>
$(document).ready(function() {

$( function() {
    $( "#datepicker" ).datepicker();
  } );

$( "#searchForm" ).submit(function( event ) {
  event.preventDefault();

  var $form = $( this ),
    term = $("#searchForm").serialize()
    url = $form.attr( "action" );

  // Send the data using post
  var posting = $.post( url, { term } );

  // Put the results in a div
  posting.done(function( data ) {
    var content = $( data ).find( "#content" );
    $( "#result" ).empty().append( content );
  });

  location.reload();
});

    $.ajax({
        url: 'http://localhost:8080/line-chart?name=line-chart-1&after=2016-08-01&before=2016-08-31',
        success: function(response) {
            var graphPoints = [];
            var timeStamps = [];
            for(var i in response.data) {
              var timestamp = JSON.stringify(response.data[i].timestamp);

              var d = new Date(0)
              d.setUTCSeconds(timestamp);
              timeStamps.push(formattedDate(d));

              var dataPoint = parseFloat(JSON.stringify(parseFloat(response.data[i].dataPoint)));
              graphPoints.push(dataPoint);
            }
            makeHighChart(timeStamps,graphPoints);
        },
        cache: false
    });
});

function formattedDate(date) {
  var year = date.getFullYear();
  var month = (1 + date.getMonth()).toString();
  month = month.length > 1 ? month : '0' + month;
  var day = date.getDate().toString();
  day = day.length > 1 ? day : '0' + day;
  return month + '/' + day + '/' + year;
}

function makeHighChart(timeStamps,dataPoints) {
    console.log("data points: " + dataPoints);
    $('#container').highcharts({
        chart: {
            type: 'line'
        },
        title: {
            text: 'Monthly Average Temperature'
        },
        subtitle: {
            text: 'Source: WorldClimate.com'
        },
        xAxis: {
            categories: timeStamps
        },
        yAxis: {
            title: {
                text: 'Temperature (Â°C)'
            }
        },
        plotOptions: {
            line: {
                dataLabels: {
                    enabled: true
                },
                enableMouseTracking: false
            }
        },
        series: [{
            name: 'Tokyo',
            data: dataPoints
        }]
    });
}

$( function() {
    $( "#datepicker" ).datepicker();
  } );

$( "#searchForm" ).submit(function( event ) {
  event.preventDefault();

  var $form = $( this ),
    term = $("#searchForm").serialize()
    url = $form.attr( "action" );

  // Send the data using post
  var posting = $.post( url, { term } );

  // Put the results in a div
  posting.done(function( data ) {
    var content = $( data ).find( "#content" );
    $( "#result" ).empty().append( content );
  });
});


    </script>

    <div id="container" style="min-width: 310px; height: 400px; margin: 0 auto"></div>
    <div class="form-mini-container">
        <h1>Add Data Point</h1>
        <form id="searchForm" class="form-mini" action="http://localhost:8080/line-chart" method="POST">
            <div class="form-row">
                <input type="text" name="graphName" placeholder="Graph Name">
            </div>
            <div class="form-row">
                <input type="text" id="datepicker" name="timestamp" required="true" placeholder="Date">
            </div>
            <div class="form-row">
                <input type="text" name="dataPoint" placeholder="value">
            </div>
            <div class="form-row">
                <button type="submit">Add</button>
            </div>
        </form>
    </div>
    </body>
</html>